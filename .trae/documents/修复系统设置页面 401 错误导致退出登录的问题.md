# 修复系统设置页面 401 错误导致退出登录的问题

## 问题原因
当普通用户访问"系统设置"页面时，会无条件调用 `/users` API 加载用户列表，但后端返回 401 错误（因为普通用户无权限），导致前端清除 token 并跳转到登录页。

## 修复方案

### 1. 优化用户列表加载逻辑（Settings.vue）
- 将 `loadUsersList()` 的调用移到条件判断中
- 只有当用户是管理员时才加载用户列表
- 添加错误处理，避免 401 错误影响其他功能

### 2. 改进 API 响应拦截器（config.ts）
- 区分 401（未认证）和 403（无权限）错误
- 401 错误：清除 token 并跳转登录页
- 403 错误：不清除 token，只显示错误提示
- 避免使用 `window.location.href` 直接跳转，改用路由跳转

### 3. 优化认证检查（auth.ts）
- 在 `checkAuth` 函数中添加更详细的错误日志
- 确保认证失败时正确清理状态

## 修改文件
1. `src/views/Settings.vue` - 条件加载用户列表
2. `src/api/config.ts` - 改进错误处理逻辑
3. `src/stores/users.ts` - 添加权限检查和错误处理